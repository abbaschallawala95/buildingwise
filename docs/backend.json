{
  "entities": {
    "Building": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Building",
      "type": "object",
      "description": "Represents a building managed within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the building."
        },
        "buildingName": {
          "type": "string",
          "description": "Name of the building."
        },
        "address": {
          "type": "string",
          "description": "Address of the building."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the building was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "buildingName",
        "address",
        "createdAt"
      ]
    },
    "Member": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Member",
      "type": "object",
      "description": "Represents a member (resident) of a building.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the member."
        },
        "buildingId": {
          "type": "string",
          "description": "Reference to Building. (Relationship: Building 1:N Member)"
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the member."
        },
        "flatNumber": {
          "type": "string",
          "description": "Flat number of the member."
        },
        "floor": {
          "type": "string",
          "description": "Floor number where the member resides."
        },
        "contactNumber": {
          "type": "string",
          "description": "Contact number of the member."
        },
        "monthlyMaintenance": {
          "type": "number",
          "description": "Monthly maintenance amount for the member."
        },
        "previousDues": {
          "type": "number",
          "description": "Previous dues of the member."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the member was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "buildingId",
        "fullName",
        "flatNumber",
        "contactNumber",
        "monthlyMaintenance",
        "previousDues",
        "createdAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction (maintenance, extra collection, or expense).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "buildingId": {
          "type": "string",
          "description": "Reference to Building. (Relationship: Building 1:N Transaction)"
        },
        "memberId": {
          "type": "string",
          "description": "Reference to Member. (Relationship: Member 1:N Transaction)"
        },
        "type": {
          "type": "string",
          "description": "Type of transaction (maintenance, extra_collection, expense)."
        },
        "title": {
          "type": "string",
          "description": "Title of the transaction."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "month": {
          "type": "string",
          "description": "Month for which the transaction is recorded."
        },
        "paymentMode": {
          "type": "string",
          "description": "Payment mode used for the transaction."
        },
        "receiptNumber": {
          "type": "string",
          "description": "Receipt number for the transaction."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the transaction was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "buildingId",
        "memberId",
        "type",
        "title",
        "amount",
        "month",
        "paymentMode",
        "receiptNumber",
        "createdAt"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense incurred for a building.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense."
        },
        "buildingId": {
          "type": "string",
          "description": "Reference to Building. (Relationship: Building 1:N Expense)"
        },
        "expenseType": {
          "type": "string",
          "description": "Type of expense (light, lift, water, repair, other)."
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "expenseDate": {
          "type": "string",
          "description": "Date when the expense was incurred.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "buildingId",
        "expenseType",
        "description",
        "amount",
        "expenseDate"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application, primarily the admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the user."
        },
        "userId": {
          "type": "string",
          "description": "User ID for login purposes."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user, used for password recovery.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "fullName",
        "userId",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/buildings/{buildingId}",
        "definition": {
          "entityName": "Building",
          "schema": {
            "$ref": "#/backend/entities/Building"
          },
          "description": "Stores building information.  The 'buildingId' is used to scope all related data (members, transactions, expenses) to this building, which is used for authorization.",
          "params": [
            {
              "name": "buildingId",
              "description": "Unique identifier for the building."
            }
          ]
        }
      },
      {
        "path": "/buildings/{buildingId}/members/{memberId}",
        "definition": {
          "entityName": "Member",
          "schema": {
            "$ref": "#/backend/entities/Member"
          },
          "description": "Stores member information. Includes denormalized 'buildingId' for authorization independence.",
          "params": [
            {
              "name": "buildingId",
              "description": "Unique identifier for the building."
            },
            {
              "name": "memberId",
              "description": "Unique identifier for the member."
            }
          ]
        }
      },
      {
        "path": "/buildings/{buildingId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction data. Includes denormalized 'buildingId' for authorization independence.",
          "params": [
            {
              "name": "buildingId",
              "description": "Unique identifier for the building."
            },
            {
              "name": "transactionId",
              "description": "Unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/buildings/{buildingId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense information. Includes denormalized 'buildingId' for authorization independence.",
          "params": [
            {
              "name": "buildingId",
              "description": "Unique identifier for the building."
            },
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. This is a path-based ownership model, ensuring only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (Firebase Auth UID)."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage building maintenance efficiently and securely.  Authorization Independence is achieved by storing the `buildingId` within the `Member`, `Transaction`, and `Expense` documents, eliminating the need for `get()` calls to the `Buildings` collection in security rules.  This enables atomic operations and simplifies rule logic.  The user's userId and other identifying information are stored in the `/users/{userId}` collection. Access control is managed through a combination of path-based ownership for user profiles and shared context using building IDs. Segregation is achieved by placing different entities (buildings, members, transactions, expenses) into separate collections. This simplifies security rules by ensuring that all documents within a collection share the same access requirements. The structure also segregates user data into a dedicated collection, ensuring a homogeneous security posture for user profiles.\n\nQAPs (Rules are not Filters): The structure facilitates secure `list` operations by ensuring that all documents in a collection share the same security requirements. For example, listing members associated with a specific building is secure because the `buildingId` is present in each member document, which can be used in security rules without needing to filter based on potentially insecure client-provided data.\n\nThe inclusion of timestamps (createdAt) in each entity supports data integrity and facilitates chronological ordering and querying. Naming conventions are consistently applied to improve readability and maintainability. Explicit state modeling is not required based on the current feature set, but a `status` field could be added to entities like `Transaction` or `Expense` in the future to support more complex workflows."
  }
}